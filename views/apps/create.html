{{define "body"}}


<div class="w-full max-w-screen-sm mx-auto">
  <h2 class="font-bold text-2xl font-headline mb-2 dark:text-white text-center">
    ðŸš€ Almost there!
  </h2>
  <div class="font-medium text-center mb-8 dark:text-white">
    Complete the last step of the setup by pasting or scanning your connection's pairing secret in the desired app to finalise the connection.
  </div>

<div class="flex flex-col">
    <a href="{{.PairingUri}}" class="w-full inline-flex bg-purple-700 cursor-pointer duration-150 focus:outline-none font-medium hover:bg-purple-900 items-center justify-center px-5 py-4 rounded-md shadow text-white transition mb-2">
      <svg class="mr-2" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path fill-rule="evenodd" clip-rule="evenodd"
          d="M13.6281 5.03035L20.9945 12.43L20.9956 12.431C21.4028 12.84 21.8601 13.0639 22.279 13.1062C22.6711 13.1459 23.0667 13.0322 23.4219 12.6949L19.4029 2.22631C18.9491 1.2345 17.6421 0.998839 16.8705 1.7739L13.6281 5.03035ZM20.5966 12.8277L20.5967 12.8278L20.5965 12.828C21.5558 13.7914 22.8871 14.0212 23.8507 13.0622L20.5884 16.3091L19.0591 17.8312L17.9915 18.8938L16.1182 17.0137C17.026 15.6333 16.8781 13.76 15.6662 12.5406L14.3908 11.2573C14.2095 11.0748 13.9176 11.074 13.7351 11.2553L13.1055 11.8809L11.5093 10.2748C11.2323 9.99609 10.7744 10.0126 10.5176 10.3196C10.2928 10.5907 10.3315 10.9906 10.5786 11.2392L12.1549 12.8252L10.9035 14.0685L9.3073 12.4624C9.03028 12.1837 8.5705 12.1981 8.31561 12.5072C8.0928 12.7764 8.13155 13.1762 8.37864 13.4249L9.95488 15.0109L9.32725 15.6346C9.14479 15.8159 9.14392 16.1077 9.32522 16.2902L10.6006 17.5735C11.8123 18.7927 13.6847 18.9526 15.0709 18.054L16.9452 19.9351L16.3577 20.5197L14.3527 22.5153C13.3889 23.4743 11.8301 23.4707 10.8708 22.5072L0.717064 12.3077C-0.242097 11.344 -0.238627 9.78546 0.725161 8.82627L6.96087 2.61994C7.92465 1.66089 9.4834 1.66451 10.4427 2.62803L20.5966 12.8277Z"
          fill="currentColor" />
      </svg>
      Open in supported app
    </a>
    <div class="text-center text-xs text-gray-600 dark:text-neutral-500">
      Only connect with apps you trust!
    </div>

    {{if not (eq .PairingSecret "")}}
      <div class="dark:text-white text-sm text-center mt-8 mb-1">Manually pair app â†“</div>
      <button id="copy-button" class="w-full inline-flex items-center justify-center px-3 py-2 cursor-pointer duration-150 transition bg-white text-purple-700 dark:bg-surface-02dp dark:text-neutral-200 border dark:border-white/10 hover:bg-gray-50 dark:hover:bg-surface-16dp bg-origin-border rounded-md focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-primary mt-2 mb-2">
        <svg class="mr-2" width="24" height="24" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
          fill="currentColor">
          <rect width="10" height="14" x="6" y="6" rx="1.5"></rect>
          <path
            d="M8.064 5.064A1.5 1.5 0 018.5 5h7A1.5 1.5 0 0117 6.5v11a1.5 1.5 0 01-.064.436A1.5 1.5 0 0018 16.5v-11A1.5 1.5 0 0016.5 4h-7a1.5 1.5 0 00-1.436 1.064z"></path>
        </svg>
        <span id="copy-text">Copy pairing secret</span>
      </button>

      <button onclick="document.getElementById('pairing-details').classList.toggle('hidden');return false" class="w-full inline-flex items-center justify-center px-3 py-2 cursor-pointer duration-150 transition bg-white text-purple-700 dark:bg-surface-02dp dark:text-neutral-200 border dark:border-white/10 hover:bg-gray-50 dark:hover:bg-surface-16dp bg-origin-border rounded-md focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-primary mb-4 lg:mb-6">
        <svg class="mr-2" width="24" height="24" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
          fill="currentColor">
          <path d="M12 14a2 2 0 100-4 2 2 0 000 4z"></path>
          <path fill-rule="evenodd"
            d="M21 12c0 2.761-4.03 5-9 5s-9-2.239-9-5 4.03-5 9-5 9 2.239 9 5zm-5 0a4 4 0 11-8 0 4 4 0 018 0z"
            clip-rule="evenodd"></path>
        </svg>
        QR code
      </button>
    {{end}}
  </div>

  <div class="flex fixed inset-0 items-center justify-center hidden" id="pairing-details">
    <div onclick="document.getElementById('pairing-details').classList.toggle('hidden');return false" class="fixed inset-0 bg-gray-900 opacity-50"></div>
    <div class="bg-white dark:bg-surface-02dp p-4 lg:px-6 rounded shadow relative">
      <h2 class="mb-4 font-semibold text-lg lg:text-xl font-headline dark:text-white">Scan QR Code in the app to pair</h2>
      <a href="{{.PairingUri}}" target="_blank" id="pairing-link" class="block border-4 border-purple-600 rounded-lg p-4 lg:p-6">
        <div id="connect-qrcode"></div>
      </a>
      <button onclick="document.getElementById('pairing-details').classList.toggle('hidden');return false"
      class="w-full inline-flex font-semibold items-center justify-center px-3 py-2 cursor-pointer duration-150 transition bg-white text-gray-700 dark:bg-surface-02dp dark:text-neutral-200 dark:border-neutral-800 hover:bg-gray-50 dark:hover:bg-surface-16dp bg-origin-border shadow rounded-md focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-primary mt-4">
        Close
      </button>
    </div>
  </div>
</div>

<script type="text/javascript" src="/public/js/qr-creator.js"></script>
<script type="text/javascript">
  // notify the opener if present of the success full connect
  window.addEventListener("load", (event) => {

    // dispatch a success event which can be listened to by the opener or by the app that embeddes the webview
    // this gives thoes apps the chance to know the user has enabled the connection
    const nwcEvent = new CustomEvent("nwc:success", { detail: {} });
    window.dispatchEvent(nwcEvent);

    // notify the opener of the successful connection
    if (window.opener) {
      window.opener.postMessage(
        {
          type: "nwc:success",
          payload: {success: true},
        },
        "*"
      );
    }
  });

  window.addEventListener("DOMContentLoaded", (event) => {
    QrCreator.render(
      {
        fill: window.matchMedia('(prefers-color-scheme: dark)').matches ? "#FFF" : "#000",
        text: "{{.PairingUri}}",
        size: 250, // in pixels
      }, //window.matchMedia('(prefers-color-scheme: dark)').matches ? "#FFF" : 
      document.getElementById("connect-qrcode")
    );

    document
      .getElementById("copy-button")
      .addEventListener("click", async (event) => {
        event.preventDefault();
        const copyButton = document.getElementById("copy-button")
        const copyText = document.getElementById("copy-text");

        if (navigator.clipboard && window.isSecureContext) {
          navigator.clipboard.writeText("{{.PairingUri}}");
        } else {
          const textArea = document.createElement("textarea");
          textArea.value = "{{.PairingUri}}";
          textArea.style.position = "absolute";
          textArea.style.opacity = 0;
          document.body.appendChild(textArea);
          textArea.select();
          await document.execCommand("copy");
          textArea.remove();
        }

        const classesToToggle = ["hover:bg-gray-50", "bg-green-600", "bg-white", "text-white", "text-purple-700"];
        classesToToggle.forEach(className => copyButton.classList.toggle(className));
        copyText.textContent = "Copied to clipboard!"
        setTimeout(() => {
        classesToToggle.forEach(className => copyButton.classList.toggle(className));
          copyText.textContent = "Copy pairing secret"
        }, 2000);
      });
  });
</script>

{{end}}
