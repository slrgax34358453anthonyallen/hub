{{define "body"}}

<div
  class="w-full lg:w-8/12 mx-auto bg-white rounded-md shadow px-4 lg:px-12 py-4 lg:py-12 mb-10"
>
  <h2 class="font-bold text-2xl font-headline mb-2">
    Create a new app connection
  </h2>

  <p class="mb-4">Authorize the new app to:</p>

  <ul class="mb-8">
    <li class="mb-2 relative pl-6">
      <span class="mr-3 absolute left-0">&#9989;</span>
      Send payments from your wallet
    </li>
  </ul>

  <form method="POST" action="/apps" accept-charset="UTF-8">
    <div class="mb-4">
      <label
        for="name"
        class="block mb-2 text-sm font-medium text-gray-900 dark:text-white"
        >App name</label
      >
      <input
        type="text"
        name="name"
        value="{{.Name}}"
        id="name"
        required
        autocomplete="off"
        class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-purple-500 focus:border-purple-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-purple-500 dark:focus:border-purple-500"
      />
    </div>
    <p class="text-gray-500 dark:text-gray-400 mb-4">
      <input {{if .ExpiresAt}}checked{{end}} id="ExpiryCheckbox" type="checkbox" class="w-4 h-4 text-purple-700 bg-gray-100 border-gray-300 rounded focus:ring-purple-700 dark:focus:ring-purple-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600"
        onclick="document.getElementById('expiryOption').classList.toggle('hidden');" >
      <label for="ExpiryCheckbox" class="ml-2 text-sm font-medium text-gray-900 dark:text-gray-300">Set an Expiry</label>
    </p>
    <div id="expiryOption" class="{{if not .ExpiresAt}}hidden{{end}} my-4">
      <div class="mb-4">
        <label
          for="ExpiresAt"
          class="block mb-2 text-sm font-medium text-gray-900 dark:text-white"
          >Expiry</label
        >
        <input
          type="date"
          name="ExpiresAt"
          value="{{.ExpiresAt}}"
          id="ExpiresAt"
          autocomplete="off"
          min=""
          class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-purple-500 focus:border-purple-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-purple-500 dark:focus:border-purple-500"
        />
      </div>
    </div>

    <p class="text-gray-500 dark:text-gray-400 mb-4">
      <input {{if .MaxAmount}}checked{{end}} id="BudgetCheckbox" type="checkbox" class="w-4 h-4 text-purple-700 bg-gray-100 border-gray-300 rounded focus:ring-purple-700 dark:focus:ring-purple-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600"
        onclick="document.getElementById('budgetOptions').classList.toggle('hidden');" >
      <label for="BudgetCheckbox" class="ml-2 text-sm font-medium text-gray-900 dark:text-gray-300">Set a Budget</label>
    </p>

    <div id="budgetOptions" class="{{if not .MaxAmount}}hidden{{end}} mt-4 mb-6">
      <p class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">
        Budget Renewal
      </p>
      <ul class="items-center w-full text-sm font-medium text-gray-900 bg-white border border-gray-200 rounded-lg sm:flex dark:bg-gray-700 dark:border-gray-600 dark:text-white">
        <li class="w-full border-b border-gray-200 sm:border-b-0 sm:border-r dark:border-gray-600">
          <div class="flex items-center pl-3">
            <input checked id="BudgetTypeNever" type="radio" value="never" name="BudgetType" class="w-4 h-4 text-purple-600 bg-gray-100 border-gray-300 focus:ring-purple-500 dark:focus:ring-purple-600 dark:ring-offset-gray-700 dark:focus:ring-offset-gray-700 focus:ring-2 dark:bg-gray-600 dark:border-gray-500">
            <label for="BudgetTypeNever" class="w-full py-3 ml-2 text-sm font-medium text-gray-900 dark:text-gray-300">Never</label>
          </div>
        </li>
        <li class="w-full border-b border-gray-200 sm:border-b-0 sm:border-r dark:border-gray-600">
          <div class="flex items-center pl-3">
            <input id="BudgetTypeDaily" type="radio" value="daily" name="BudgetType" class="w-4 h-4 text-purple-600 bg-gray-100 border-gray-300 focus:ring-purple-500 dark:focus:ring-purple-600 dark:ring-offset-gray-700 dark:focus:ring-offset-gray-700 focus:ring-2 dark:bg-gray-600 dark:border-gray-500">
            <label for="BudgetTypeDaily" class="w-full py-3 ml-2 text-sm font-medium text-gray-900 dark:text-gray-300">Daily</label>
          </div>
        </li>
        <li class="w-full border-b border-gray-200 sm:border-b-0 sm:border-r dark:border-gray-600">
          <div class="flex items-center pl-3">
            <input id="BudgetTypeWeekly" type="radio" value="weekly" name="BudgetType" class="w-4 h-4 text-purple-600 bg-gray-100 border-gray-300 focus:ring-purple-500 dark:focus:ring-purple-600 dark:ring-offset-gray-700 dark:focus:ring-offset-gray-700 focus:ring-2 dark:bg-gray-600 dark:border-gray-500">
            <label for="BudgetTypeWeekly" class="w-full py-3 ml-2 text-sm font-medium text-gray-900 dark:text-gray-300">Weekly</label>
          </div>
        </li>
        <li class="w-full dark:border-gray-600">
          <div class="flex items-center pl-3">
            <input id="BudgetTypeMonthly" type="radio" value="monthly" name="BudgetType" class="w-4 h-4 text-purple-600 bg-gray-100 border-gray-300 focus:ring-purple-500 dark:focus:ring-purple-600 dark:ring-offset-gray-700 dark:focus:ring-offset-gray-700 focus:ring-2 dark:bg-gray-600 dark:border-gray-500">
            <label for="BudgetTypeMonthly" class="w-full py-3 ml-2 text-sm font-medium text-gray-900 dark:text-gray-300">Monthly</label>
          </div>
        </li>
      </ul>
      <div class="mt-2">
        <label for="MaxAmount" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">
          Monthly Amount (in sats)
        </label>
        <input type="text" name="MaxAmount" id="MaxAmount" aria-describedby="helper-text-explanation"
          class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-purple-500 focus:border-purple-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-purple-500 dark:focus:border-purple-500"
          pattern="{0-9}.*"
          value={{.MaxAmount}}>
      </div>
      <div class="mt-2">
        <label for="MaxAmountPerTransaction" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">
          Max Amount (per transaction)
        </label>
        <input type="text" name="MaxAmountPerTransaction" id="MaxAmountPerTransaction"
          aria-describedby="helper-text-explanation"
          class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-purple-500 focus:border-purple-500 block w-full p-2.5  dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-purple-500 dark:focus:border-purple-500"
          pattern="{0-9}.*"
          value={{.MaxAmountPerTransaction}}>
      </div>
    </div>

    <div class="flex flex-col sm:flex-row sm:justify-center">
      <a
        href="/apps"
        class="inline-flex bg-white border border-warmGray cursor-pointer dark:bg-surface-02dp dark:border-neutral-800 dark:hover:bg-surface-16dp dark:text-neutral-200 duration-150 focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-orange-bitcoin focus:outline-none font-medium hover:bg-gray-50 items-center justify-center px-5 py-3 rounded-md shadow text-gray-700 transition w-full sm:w-[250px] sm:mr-8 mt-8 sm:mt-0 order-last sm:order-first"
      >
        Cancel
      </a>

      <button
        type="submit"
        class="inline-flex w-full sm:w-[250px] bg-purple-700 border border-warmGray cursor-pointer dark:bg-surface-02dp dark:border-neutral-800 dark:hover:bg-surface-16dp dark:text-neutral-200 duration-150 focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-orange-bitcoin focus:outline-none font-medium hover:bg-purple-900 items-center justify-center px-5 py-3 rounded-md shadow text-white transition"
      >
        Confirm
      </button>
    </div>
  </form>

  {{if .User.Email}}
    <hr class="mt-8 mb-4">

    <p class="text-sm text-gray-500 text-center">
      You're logged in as <span class="font-mono">{{.User.Email}}</span><br>
    </p>
  {{end}}
</div>

<script type="text/javascript">
  var today = new Date().toISOString().split('T')[0];
  document.getElementById("ExpiresAt").min = today;
</script>
{{end}}
